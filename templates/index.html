{% extends "layout.html" %}
{% block content %}

<div class="alert alert-danger" role="alert">
  Alerta: Todo contenido referente a algun estudiante o profesor sera eliminado. Tambien si es contenido pornografico
</div>

<section class="Botones-grip">
  <button id="Columna" onclick="column()"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
    <path fill-rule="evenodd" d="M2.625 6.75a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875 0A.75.75 0 0 1 8.25 6h12a.75.75 0 0 1 0 1.5h-12a.75.75 0 0 1-.75-.75ZM2.625 12a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0ZM7.5 12a.75.75 0 0 1 .75-.75h12a.75.75 0 0 1 0 1.5h-12A.75.75 0 0 1 7.5 12Zm-4.875 5.25a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875 0a.75.75 0 0 1 .75-.75h12a.75.75 0 0 1 0 1.5h-12a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd" />
  </svg>
  </button>
<button id="wrap" onclick="wrap()"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="size-6">
    <path fillRule="evenodd" d="M3 6a3 3 0 0 1 3-3h2.25a3 3 0 0 1 3 3v2.25a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6Zm9.75 0a3 3 0 0 1 3-3H18a3 3 0 0 1 3 3v2.25a3 3 0 0 1-3 3h-2.25a3 3 0 0 1-3-3V6ZM3 15.75a3 3 0 0 1 3-3h2.25a3 3 0 0 1 3 3V18a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3v-2.25Zm9.75 0a3 3 0 0 1 3-3H18a3 3 0 0 1 3 3V18a3 3 0 0 1-3 3h-2.25a3 3 0 0 1-3-3v-2.25Z" clipRule="evenodd" />
  </svg>
  </button>
</section>

<section class="List-Files" id="List-Files">
  {% for File in File %}
  <div class="File">
    {% if File.tipo in ["jpg", "jpeg", "png", "gif"] %}
    <picture>
      <img class="Icono_Documento" src="{{ File.ruta }}" alt="{{ File.nombre }}" width="150" loading="lazy" />
    </picture>
    {% elif File.tipo == "mp4" %}
    <picture>
      <video id="my-video" class="video-js" width="auto" height="auto" controls>
        <source src="{{ File.ruta }}" type="video/mp4">
      </video>
    </picture>
    {% elif File.tipo in ["pdf", "rar", "zip"] %}
    <picture>
      <embed class="Icono_Documento" src="{{ File.ruta }}" type="application/pdf" width="150" height="200">
    </picture>
    {% elif File.tipo in ["aac", "wav","flac","ogg","aiff","m4a"] %}
    <picture>
      <iframe class="Icono_Documento" width="150" height="200" src="{{ File.ruta }}" ></iframe>
    </picture>
    {% elif File.tipo in ["py", "js", "html", "css", "txt", "java", "jav"] %}
    <picture>
      <img src="{{ url_for('static', filename='Logo/codigo.png') }}" alt="C칩digo">
    </picture>
    {% elif File.tipo in ["exe"] %}
    <picture>
      <embed class="Icono_Documento" src="{{ File.ruta }}" type="application/exe" width="150" height="200">
    </picture>
    {% endif %}
    <span class="Texto">{{ File.nombre }}</span>

    <div class="file-actions">
      <a href="#" onclick="downloadFile('{{ File.nombre }}')">
          Descargar
      </a>
      
      <!-- Reaction buttons with emojis -->
      <div class="reaction-buttons">
        <button class="reaction-btn like-btn {% if File.user_reaction == 'likes' %}active{% endif %}" 
                onclick="reactToFile('{{ File.nombre }}', 'likes')">
          <span class="emoji">游녨</span>
          <span class="like-count">{{ File.likes }}</span>
        </button>
        <button class="reaction-btn dislike-btn {% if File.user_reaction == 'dislikes' %}active{% endif %}" 
                onclick="reactToFile('{{ File.nombre }}', 'dislikes')">
          <span class="emoji">游눨</span>
          <span class="dislike-count">{{ File.dislikes }}</span>
        </button>
        <button class="reaction-btn love-btn {% if File.user_reaction == 'love' %}active{% endif %}" 
                onclick="reactToFile('{{ File.nombre }}', 'love')">
          <span class="emoji">仇벒잺</span>
          <span class="love-count">{{ File.love|default(0) }}</span>
        </button>
        <button class="reaction-btn laugh-btn {% if File.user_reaction == 'laugh' %}active{% endif %}" 
                onclick="reactToFile('{{ File.nombre }}', 'laugh')">
          <span class="emoji">游땍</span>
          <span class="laugh-count">{{ File.laugh|default(0) }}</span>
        </button>
      </div>
    </div>
  </div>
  {% endfor %}
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    let lazyImages = document.querySelectorAll("img.lazy");
    let observer = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          let img = entry.target;
          img.src = img.dataset.src;
          img.classList.remove("lazy");
          observer.unobserve(img);
        }
      });
    });

    lazyImages.forEach(img => observer.observe(img));
  });
</script>

<script>
  function downloadFile(fileName) {
    // Evitar que la p치gina recargue o ejecute la descarga sin que el usuario haga clic
    event.preventDefault();
    
    // Realizar la descarga
    window.location.href = '/descarga/' + fileName;
  }
  
  // Function to handle emoji reactions
  function reactToFile(fileName, reaction) {
    event.preventDefault();
    
    // Send the reaction to the server
    fetch(`/react/${fileName}/${reaction}`, {
      method: 'POST',
    })
    .then(response => response.json())
    .then(data => {
      // Update the reaction counts on the page
      const fileElement = event.target.closest('.File');
      
      // Update all reaction counts
      const reactionTypes = ['likes', 'dislikes', 'love', 'laugh'];
      reactionTypes.forEach(reactionType => {
        const countElement = fileElement.querySelector(`.${reactionType}-count`);
        if (countElement) {
          countElement.textContent = data[reactionType];
        }
      });
      
      // Clear previous active states
      const allButtons = fileElement.querySelectorAll('.reaction-btn');
      allButtons.forEach(button => button.classList.remove('active'));
      
      // Add active state to current reaction if user has reacted
      if (data.user_reaction) {
        const activeButton = fileElement.querySelector(`.${data.user_reaction}-btn`);
        if (activeButton) {
          activeButton.classList.add('active');
        }
      }
      
      // Add a pulse animation
      const button = event.target.closest('.reaction-btn');
      button.classList.add('pulse-animation');
      setTimeout(() => {
        button.classList.remove('pulse-animation');
      }, 500);
    })
    .catch(error => console.error('Error:', error));
  }
</script>

<script>
function column() {
    let List = document.getElementById('List-Files');
    let Button = document.getElementById('Columna');
    let Button2 = document.getElementById('wrap');

    Button.style.border = "1px solid #f0f0f0"; // Borde gris claro
    Button2.style.border = "none"; // Quitar el borde del otro bot칩n

    List.style.flexDirection = "column";
}

function wrap() {
    let List = document.getElementById('List-Files');
    let Button = document.getElementById('wrap');
    let Button1 = document.getElementById('Columna');

    Button.style.border = "1px solid #f0f0f0"; // Borde gris claro
    Button1.style.border = "none"; // Quitar el borde del otro bot칩n

    List.style.flexDirection = "row";
    List.style.flexWrap = "wrap";
}

wrap();
</script>

<script>
  document.addEventListener('contextmenu', function(event) {
      event.preventDefault();
  });
</script>

<style>
  .reaction-btn.active {
    border: 2px solid #007bff;
    background-color: rgba(0, 123, 255, 0.1);
  }
  
  .pulse-animation {
    animation: pulse 0.5s;
  }
  
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }
</style>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8169958814797444"
     crossorigin="anonymous"></script>

{% endblock %}